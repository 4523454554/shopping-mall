<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org"
    layout:decorate="~{layouts/layout.html}">

<head>
    <title>개인정보동의</title>
</head>

<body>

    <div layout:fragment="content">
        <div class="container">
            <div>
                <h1 class="text-danger">해당 페이지는 어떠한 법적 효력이 없는 데모용입니다.</h1>
                <h1>개인 정보 동의</h1>
            </div>

            <!--본문 들어갈 곳-->
            <h5>
                <div th:text="${user.getEmail()}"></div>님의 개인 정보 동의
            </h5>

            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="isMandatoryCheck" required>
                <label class="form-check-label" for="isMandatoryCheck">
                    개인정보에 동의하시겠습니까? (필수)
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="isMarketingCheck">
                <label class="form-check-label" for="isMarketingCheck">
                    개인정보를 마케팅으로 사용하시는 것에 동의하시겠습니까? (선택)
                </label>
            </div>
            <button id="agree-button" class="btn btn-primary">동의</button>
        </div>
        <script>
            window.addEventListener('load', (e) => {
                const agreeButton = document.getElementById('agree-button');

                agreeButton.addEventListener('click', (e) => {
                    // e.preventDefault();

                    let isMandatoryAgree = document.getElementById('isMandatoryCheck').checked;
                    let isMarketingAgree = document.getElementById('isMarketingCheck').checked;

                    let agreeData = {
                        method: 'POST',
                        body: JSON.stringify({
                            isMandatoryAgree,
                            isMarketingAgree
                        }),
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    };

                    fetch(`/api/v1/privacy/agree`, agreeData)
                        .then(res => {
                            if (!res.ok) {
                                alert('필수 항목은 반드시 체크해야합니다');
                            }
                            if (res.ok) {
                                window.location.replace('http://localhost:8080/me/update')
                            }
                            res.json();
                        })
                        .then(json => {
                            console.log(json)
                        })
                        .catch(err => {
                            alert(err.message);
                        });
                })
            })
        </script>
    </div>
</body>
<script>






    // fetch("http://localhost:8080/me/privacy/agree", {
    //     method: "POST",
    //     headers: {
    //         "Content-Type": "application/json",
    //     },
    //     body: JSON.stringify({

    //     })
    // })
</script>

</html>